<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Carlos Willy Ruiz Villalobos /Albert Gaitan Pezo">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&family=Source+Sans+Pro:wght@300;400&display=swap" rel="stylesheet">
    <style>

        body {
            background-color: #f5f5f5;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
        }
        table.table-center td, table.table-center th {
            text-align: center;
            vertical-align: middle;
            height: 2.48rem;
            background-color: silver;
        }
        .bg-yellow{
            background-color: #faf206 !important;
        }
        .bg-dark{
            background-color: #8e44ad !important;
        }
        .bg-info{
            background-color: #2c3e50 !important;
        color: #fff;
        }
    </style>
    <title>MATRIZ DE RIESGO -WIGA-UNSM-FISI</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <header class="bg-light py-3">
                    <div class="container">
                      <div class="row">
                        <div class="col-md-4">
                            <img src="https://unsm.edu.pe/wp-content/uploads/2019/01/Logo-UNSM.png" alt="">
                        </div>
                        <div class="col-md-8">
                          <h1 class="text-primary text-end mb-0">UNIVERSIDAD NACIONAL DE SAN MARTIN</h1>
                          <h2 class="text-end mb-0">Facultad de Ingenieria de Sistemas e Informática</h2>
                        </div>
                      </div>
                    </div>
                  </header>
            </div>
        </div><br>
        <div class="row">
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-4">
                        
                    </div>
                    <div class="col-8">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <tr>
                                    <td colspan="5" class="bg-info text-center">IMPACTO</td>
                                </tr>
                                <tr>
                                    <td class="bg-dark text-white" style="width:100px;">Mínima</td>
                                    <td class="bg-dark text-white" style="width:100px;">Menor</td>
                                    <td class="bg-dark text-white" style="width:100px;">Moderada</td>
                                    <td class="bg-dark text-white" style="width:100px;">Mayor</td>
                                    <td class="bg-dark text-white" style="width:100px;">Máxima</td>
                                </tr>
                                <tr>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,2,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,3,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                    <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(0,4,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                    <tr><td class="bg-dark text-white">Muy Alta</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,0,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Alta</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,1,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Media</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,2,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Baja</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,3,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td></tr>
                                    <tr>
                                        <td class="bg-dark text-white">Muy Baja</td>
                                        <td class="bg-dark text-dark"><input oninput="SS.triggerHeaders(1,4,this.value)" value="0" style="width:80px;" type="number" class="form-control form-control-sm"></td>
                                    </tr>
                                    <tr class="bg-info">
                                        <td class="bg-info text-white text-center" colspan="2" class="text-center">PROBABILIDAD</td>
                                    </tr>
                            </table>
                        </div>
                    </div>
                    <div class="col-8">
                        
                        <div class="table-responsive">
                            <table id="table-matriz" class="table table-bordered table-sm table-center">
                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="d-flex justify-content-end mb-2"><button data-bs-toggle="modal" data-bs-target="#modal_evento" class="btn btn-primary float-right btn-sm">Crear evento</button></div>
                <div class="table-responsive">
                    <table class="w-100 table table-sm  table-bordered">
                        <thead>
                            <th style="font-size:11px">Evento</th>
                            <th style="font-size:11px">Probabilidad</th>
                            <th style="font-size:11px">Impacto</th>
                            <th style="font-size:11px">Valor</th>
                            <th style="font-size:11px">Nivel de Riesgo</th>
                            <th style="font-size:11px">Quitar</th>
                        </thead>
                        <tbody id="table-eventos">
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-12 col-lg-5">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered" style="font-size:12px !important">
                        <thead>
                            <tr>
                                <th rowspan="2">Color</th>
                                <th style="font-size:11px" rowspan="2">Nivel de Riesgo</th>
                                <th style="font-size:11px" colspan="2">Rango</th>
                            </tr>
                            <tr>
                                
                                <th style="font-size:11px;width:100px">De</th>
                                <th style="font-size:11px;width:100px">A</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="bg-success"></td>
                                <td>Riesgo Aceptable</td>
                                <td><input oninput="SS.triggerEscala(0,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(0,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-yellow"></td>
                                <td>Riesgo Tolerable</td>
                                <td><input oninput="SS.triggerEscala(1,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(1,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-warning"></td>
                                <td>Riesgo Alto</td>
                                <td><input oninput="SS.triggerEscala(2,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(2,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                            <tr>
                                <td class="bg-danger"></td>
                                <td>Riesgo Extremo</td>
                                <td><input oninput="SS.triggerEscala(3,0,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                                <td><input oninput="SS.triggerEscala(3,1,this.value)" value="0" type="number" class="form-control form-control-sm"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-6 col-lg-3">
                <img src="riesgo.avif" class="img-fluid" width="350">
            </div>
            <div class="col-6 col-lg-4">
                <h3 class="text-end text-secondary mb-0">Matriz de Riesgos</h3>
                <p class="text-end mb-0">Carlos Willy Ruiz Villalobos / Albert Gaitan Pezo</p>
                <p class="text-end mb-0">Ing. SEGUNDO ROGER RAMIREZ SHUPINGAHUA </p>
            </div>
        </div>

        <div class="modal" tabindex="-1" id="modal_evento">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Crea un evento de Riesgo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form_evento">
                        <div class="mb-3">
                          <label for="evento" class="form-label">Nombre del evento</label>
                          <input type="text" class="form-control" id="evento" name="evento">
                        </div>
                        <div class="mb-3">
                          <label for="probabilidad" class="form-label">Probabilidad</label>
                          <select class="form-select" id="probabilidad" name="probabilidad">
                            <option value="0">Muy alta</option>
                            <option value="1">Alta</option>
                            <option value="2">Media</option>
                            <option value="3">Baja</option>
                            <option value="4">Muy baja</option>
                          </select>
                        </div>
                        <div class="mb-3">
                          <label for="impacto" class="form-label">Impacto</label>
                          <select class="form-select" id="impacto" name="impacto">
                            <option value="0">Mínima</option>
                            <option value="1">Menor</option>
                            <option value="2">Moderada</option>
                            <option value="3">Mayor</option>
                            <option value="4">Máxima</option>
                          </select>
                        </div>
                      </form>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="SS.createEvent()" class="btn btn-primary">Crear Evento</button>
                </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const myModal = new bootstrap.Modal(document.getElementById('modal_evento'), {keyboard: false});
        const SS = {
            impacto : [0,0,0,0,0],
            proba : [0,0,0,0,0],
            name:{
                impacto:['Mínima','Menor','Moderada','Mayor','Máxima'],
                proba:['Muy alta','Alta','Media','Baja','Muy baja']
            },
            matriz :[],
            eventos:[],
            escalas : [
                {color:'#198754',nivel:'Riesgo Aceptable',rango:[0,0]},
                {color:'#faf206',nivel:'Riesgo Tolerable',rango:[0,0]},
                {color:'#ffc107',nivel:'Riesgo Alto',rango:[0,0]},
                {color:'#dc3545',nivel:'Riesgo Extremo',rango:[0,0]}
            ],
          
            init:()=>{

                for(let i=0;i<SS.proba.length;i++){
                    SS.matriz[i] = [];
                    for(let j=0;j<SS.impacto.length;j++){
                    SS.matriz[i][j] = {color:'#silver',value:0};
                    }
                }
                SS.renderMatriz();
                
            },
            triggerHeaders:(tipo,x,value)=>{
                if(tipo==0){
                    SS.impacto[x] = parseInt(value);
                }else if(tipo==1){
                    SS.proba[x] = parseInt(value);
                }
                SS.createMatriz();
                
            },
            createMatriz:()=>{
                let html = '';
                for(let i=0;i<SS.proba.length;i++){
                    for(let j=0;j<SS.impacto.length;j++){
                        const value = SS.proba[i]*SS.impacto[j];
                        let color= 'silver';
                        SS.escalas.map(res=>{
                            if(res.rango[0]>0 && res.rango[1]>0){
                                if(value >=res.rango[0] && value<= res.rango[1]){
                                color = res.color;
                                }
                            }
                            
                        });
                        SS.matriz[i][j]={color:color,value:value}; 
                    }
                }
                SS.renderMatriz();
            },
            renderMatriz:()=>{
                let html = '';
                for(let i=0;i<SS.matriz.length;i++){
                    html += '<tr>';
                    for(let j=0;j<SS.matriz.length;j++){
                        html += `<td class="text-white" style="background-color:${SS.matriz[i][j].color}">${(SS.matriz[i][j].value)}</td>`;
                    }
                    html += '</tr>';
                }
                document.querySelector('#table-matriz').innerHTML = html;
            },
            triggerEscala:(i,x,value)=>{
                SS.escalas[i].rango[x] = parseInt(value);
                SS.createMatriz();
            },
            createEvent:()=>{
                try {
                    const formData = new FormData(document.querySelector('#form_evento'));
                    const formObj = Object.fromEntries(formData.entries());
                    if(formObj.evento.length==0) throw 'Debe ingresar un nombre de evento';
                    //validamos que probabilidad e impacto no sean 0
                    if(SS.proba.indexOf(0)>-1) throw 'Debe ingresar un valor mayor de cero para todas las probabilidades';
                    if(SS.impacto.indexOf(0)>-1) throw 'Debe ingresar un valor mayor de cero para todos los impactos';
                    SS.escalas.map(res=>{
                        if(res.rango[0]==0 || res.rango[1]==0) throw 'Debe ingresar un valor mayor de cero para todos los rangos de las escalas de riesgo';
                    });
                    

                    SS.eventos.push({
                        evento:formObj.evento,
                        probabilidad:SS.name.proba[formObj.probabilidad],
                        impacto:SS.name.impacto[formObj.impacto],
                        color:SS.matriz[formObj.probabilidad][formObj.impacto].color,
                        valor:SS.matriz[formObj.probabilidad][formObj.impacto].value,
                        riesgo:SS.escalas.filter(res=>res.color==SS.matriz[formObj.probabilidad][formObj.impacto].color)[0].nivel
                    });

                    SS.renderEventos();

                    myModal.hide();
                } catch (error) {
                    alert(error);
                }
            },
            renderEventos:()=>{
                let html = '';
                SS.eventos.map((res,i)=>{
                    html += `<tr>
                                <td style="font-size:11px;">${res.evento}</td>
                                <td style="font-size:11px;">${res.probabilidad}</td>
                                <td style="font-size:11px;">${res.impacto}</td>
                                <td style="font-size:11px;">${res.valor}</td>
                                <td style="background-color:${res.color};font-size:11px;">${res.riesgo}</td>
                                <td><button onclick="SS.removeEvento(${i})" class="btn btn-primary btn-sm">Quitar</button></td>
                            </tr>`;
                }).join();
                document.querySelector('#table-eventos').innerHTML = html;
            },
            removeEvento:(i)=>{
                SS.eventos.splice(i,1);
                SS.renderEventos();
            }
        }
        document.addEventListener('DOMContentLoaded',()=>{
            SS.init();
        });
    </script>
</body>
</html>